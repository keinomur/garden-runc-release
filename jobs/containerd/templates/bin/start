#!/usr/bin/env bash
set -eu

# shellcheck disable=SC1091
source /var/vcap/jobs/containerd/bin/envs

exec 1>> "${LOG_DIR}/containerd_ctl.log"
exec 2>> "${LOG_DIR}/containerd_ctl.log"

if [ -n "${IS_RUNNING_SYSTEMD}" ]; then
  rm -f /lib/systemd/system/containerd.service
  cp /var/vcap/jobs/containerd/config/containerd.service /lib/systemd/system/
  /bin/systemctl daemon-reload
  /bin/systemctl start containerd.service
else
  /var/vcap/jobs/containerd/bin/containerd_start
fi
